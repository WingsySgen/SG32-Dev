### SG32-Dev

***

SG32D：基于Sipeed FPGA的CPU/框架。

- [简介](#简介)
- [使用方法](#使用方法)



#### 简介

***

SG32是基于Tang FPGA的32位CPU/框架。

SG32D作为SG32的Dev版本，目前是一个定长指令，哈佛结构，单周期设计的处理器。

该项目使用Verilog在FPGA上实现软核本体，使用C++实现汇编器。可以使用任意文本编辑器编写适用于SG32的汇编文本，然后使用汇编器进行汇编，烧录到SG32中即可。保证模块化、低耦合开发，CPU部分被封装在单独的模块中，并将IO等资源引出，保证在添加外设时无需更改CPU内部结构。在该框架下可接任意IO以更加方便地实现软核 + FPGA的开发模式。

自述文档只对项目进行简介，并说明使用方法。技术细节请移步项目Wiki。



#### 使用方法

***

环境要求：

```
1. C++17及以上的编译环境，以编译汇编器
2. 高云云源IDE（直接使用）或任意Verilog环境（需要自行配置模块接口与IP核）
```

`\Verilog`下是CPU的实现，下载并将其添加到工程中即可。

`\Cpp`下是汇编器的实现。

##### 软核烧录

如果你使用的FPGA是Sipeed的Tang Mega 138k，你可以不对代码进行任何修改。如果你使用的是Tang系列的FPGA，可能需要对一部分IP核进行修改。如果你使用的是非Tang系列的FPGA，那么需要重新生成所有IP核。

进行物理约束之后，直接综合布局布线烧录到FPGA中即可。

对于Tang Mega 138k，直接烧录的结果是LED5闪烁，LED4常亮，LED0到LED3按二进制自增。

项目中包含默认程序的初始化文件，其它开发板可以在生成RAM时将程序写入RAM中。默认程序中包含热烧录程序，之后就可以进行UART热烧录而不再需要通过Verilog烧录了。

##### 汇编器使用

编译sg32-asm.cpp文件，生成汇编器可执行文件，然后在项目目录下运行汇编器。

如果没有给汇编器任何参数，那么汇编器会在当前目录中尝试寻找一个名为`design.sg`的文件，你需要将你的代码写到这个文件中。如果汇编代码不存在问题，那么会在项目目录下产生一个`data`与一个`prog`，分别代表哈佛结构下数据RAM与代码RAM中的内容。接下来运行UART烧录程序或初始化文件生成程序，进行热烧录或生成初始化文件进行Verilog烧录。

如果你只需要需要一个能工作在FPGA上，但可以不像RISC-V那样专业的软核，作为一个简易的实现，你可以仅仅了解如何通过**汇编**让这块CPU工作即可。